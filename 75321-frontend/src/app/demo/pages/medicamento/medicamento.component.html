<ngx-spinner type="ball-atom" size = "large" color = "#FFFFFF">
  <p>{{titleSpinner}}</p>
</ngx-spinner>
<div class="container">
  <div class="card">
    <div class="card-header">
      <div class="row align-items-center">
        <div class="col-lg-7">
          <h3 class="mb-0">
            <i class="fa fa-medkit"></i>
            &nbsp;Lista de medicamentos
          </h3>
          <small>Estos son los medicamentos registrados en el sistema.</small>
        </div>
        <div class="col-lg-5 text-end">
          <button class="btn btn-outline-primary" (click)="abrirNuevoMedicamento()">Nuevo Medicamento</button>
        </div>
      </div>
    </div>

    <div class="card-body">
      <div class="mb-3">
        <input type="text" class="form-control" placeholder="Buscar por nombre, descripcion, presentacion..."
          [(ngModel)]="filtroColumna" />
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Id</th>
              <th>Nombre de medicamento</th>
              <th>Descripcion</th>
              <th>Presentacion</th>
              <th>Fecha de compra</th>
              <th>Fecha de vencimiento</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody *ngIf="medicamentosList.length > 0">
            <tr *ngFor="let medicamento of medicamentosList | filterMedicamentos: filtroColumna">
              <td>{{ medicamento.id }}</td>
              <td>{{medicamento.nombre}}</td>
              <td>{{medicamento.descripcion}}</td>
              <td>{{medicamento.presentacion}}</td>
              <td>{{medicamento.fechaCompra | date}}</td>
              <td>{{medicamento.fechaVence | date}}</td>
              <td>
                <button class="btn btn-outline-primary" (click)="abrirEditarMedicamento(medicamento)">
                  <i class="fa fa-edit"></i>Editar</button>
              </td>
            </tr>
          </tbody>
          <tbody *ngIf="medicamentosList.length === 0">
            <tr>
              <td colspan="7" class="text-center">No hay medicamentos disponibles.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Nuevo Medicamento -->
<div class="modal fade" id="modalCrearMedicamento" tabindex="-1" aria-labelledby="modalCrearMedicamentoLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCrearMedicamentoLabel">{{titleModal}}</h5>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col">
            <form [formGroup]="form">
              <!-- Nombre de medicamento -->
              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre de medicamento</label>
                <input type="text" formControlName="nombre" class="form-control" id="nombre"
                  placeholder="Ingrese el nombre del medicamento"
                  [ngModel]="medicamentoSelected ? medicamentoSelected.nombre : ''" />
                <div *ngIf="form.get('nombre')?.hasError('required') && form.get('nombre')?.touched"
                  class="text-danger">
                  El nombre del medicamento es requerido.
                </div>
                <div *ngIf="form.get('nombre')?.hasError('minLength') && form.get('nombre')?.touched"
                  class="text-danger">
                  El nombre del medicamento debe tener al menos 4 caracteres.
                </div>
                <div *ngIf="form.get('nombre')?.hasError('maxLength') && form.get('nombre')?.touched"
                  class="text-danger">
                  El nombre del medicamento debe tener máximo 12 caracteres.
                </div>
              </div>
              <!-- Descripcion de medicamento -->
              <div class="mb-3">
                <label for="descripcion" class="form-label">Descripcion</label>
                <input type="text" formControlName="descripcion" class="form-control" id="descripcion"
                  placeholder="Ingrese la descripcion del medicamento"
                  [ngModel]="medicamentoSelected ? medicamentoSelected.descripcion : ''" />
                <div *ngIf="form.get('descripcion')?.hasError('required') && form.get('descripcion')?.touched"
                  class="text-danger">
                  La descripcion del medicamento es requerida.
                </div>
                <div *ngIf="form.get('descripcion')?.hasError('minLength') && form.get('descripcion')?.touched"
                  class="text-danger">
                  La descripcion del medicamento debe tener al menos 4 caracteres.
                </div>
                <div *ngIf="form.get('descripcion')?.hasError('maxLength') && form.get('descripcion')?.touched"
                  class="text-danger">
                  La descripcion del medicamento debe tener máximo 12 caracteres.
                </div>
              </div>
              <!-- Presentacion de medicamento -->
              <div class="mb-3">
                <label for="presentacion" class="form-label">Presentacion</label>
                <input type="text" formControlName="presentacion" class="form-control" id="presentacion"
                  placeholder="Ingrese la presentacion del medicamento"
                  [ngModel]="medicamentoSelected ? medicamentoSelected.presentacion : ''" />
                <div *ngIf="form.get('presentacion')?.hasError('required') && form.get('presentacion')?.touched"
                  class="text-danger">
                  La presentacion del medicamento es requerida.
                </div>
                <div *ngIf="form.get('presentacion')?.hasError('minLength') && form.get('presentacion')?.touched"
                  class="text-danger">
                  La presentacion del medicamento debe tener al menos 4 caracteres.
                </div>
                <div *ngIf="form.get('presentacion')?.hasError('maxLength') && form.get('presentacion')?.touched"
                  class="text-danger">
                  La presentacion del medicamento debe tener máximo 12 caracteres.
                </div>
              </div>
              <!-- Fecha de compra de medicamento -->
              <div class="mb-3">
                <label for="fechaCompra" class="form-label">Fecha de compra</label>
                <input type="date" formControlName="fechaCompra" class="form-control" id="fechaCompra"
                  placeholder="Ingrese la fecha de compra del medicamento" />
                <div *ngIf="form.get('fechaCompra')?.hasError('required') && form.get('fechaCompra')?.touched"
                  class="text-danger">
                  La fecha de compra del medicamento es requerida.
                </div>
              </div>
              <!-- Fecha de compra de vencimiento -->
              <div class="mb-3">
                <label for="fechaVence" class="form-label">Fecha de vencimiento</label>
                <input type="date" formControlName="fechaVence" class="form-control" id="fechaVence"
                  placeholder="Ingrese la fecha de vencimiento del medicamento" />
                <div *ngIf="form.get('fechaVence')?.hasError('required') && form.get('fechaVence')?.touched"
                  class="text-danger">
                  La fecha de vencimiento del medicamento es requerida.
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="guardarMedicamento()"
          [disabled]="form.invalid">{{titleBoton}}</button>
      </div>
    </div>
  </div>
</div>
